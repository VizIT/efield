/*!
 * Copyright 2013 VizIT Solutions
 *
 *    Licensed under the Apache License, Version 2.0 (the "License");
 *    you may not use this file except in compliance with the License.
 *    You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *    Unless required by applicable law or agreed to in writing, software
 *    distributed under the License is distributed on an "AS IS" BASIS,
 *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *    See the License for the specific language governing permissions and
 *    limitations under the License.
 */
function getGLContext(a){if(a=a.getContext("webgl",{antialias:!0})||a.getContext("experimental-webgl",{antialias:!0}))a.enable(a.DEPTH_TEST),a.depthFunc(a.LESS);return a}function compileShader(a,d,b){b=a.createShader(b);a.shaderSource(b,d);a.compileShader(b);if(!a.getShaderParameter(b,a.COMPILE_STATUS))throw"Shader compile failed with:"+a.getShaderInfoLog(b);return b}function createProgram(a,d,b){var f=a.createProgram();a.attachShader(f,d);a.attachShader(f,b);a.linkProgram(f);return f}
function createBuffer(a,d){var b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,d,a.STATIC_DRAW);return b}function createIndexBuffer(a,d){var b=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b);a.bufferData(a.ELEMENT_ARRAY_BUFFER,d,a.STATIC_DRAW);return b}function bindBuffer(a,d,b,f,c,g,m,k){a.bindBuffer(a.ARRAY_BUFFER,d);d=a.getAttribLocation(f,b);a.enableVertexAttribArray(d);a.vertexAttribPointer(d,c,g,!1,m,k)}
function loadTexture(a,d,b,f){var c=a.createTexture(),g=new Image;g.onload=function(){onTextureLoaded(a,g,c,b,f)};g.src=d;return c}function onTextureLoaded(a,d,b,f,c){a.activeTexture(a.TEXTURE0+f);a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST);a.generateMipmap(a.TEXTURE_2D);c()}
function bindTexture(a,d,b,f,c){a.activeTexture(a.TEXTURE0+f);a.bindTexture(a.TEXTURE_2D,b);d=a.getUniformLocation(d,c);a.uniform1i(d,f)}function generateModelViewMatrix(a){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,a,0,0,1])}function generatePerspectiveMatrix(a,d,b,f){return new Float32Array([b/a,0,0,0,0,b/d,0,0,0,0,-(f+b)/(f-b),-1,0,0,-2*f*b/(f-b),0])}function generateOrthographicMatrix(a,d,b,f){return new Float32Array([1/a,0,0,0,0,1/d,0,0,0,0,-2/(f-b),0,0,0,-(f+b)/(f-b),1])}
function loadUniform3f(a,d,b,f,c,g){d=a.getUniformLocation(d,b);-1==d?alert("Can not find uniform"+b+"."):a.uniform3f(d,f,c,g)}function loadUniform4f(a,d,b,f,c,g,m){d=a.getUniformLocation(d,b);-1==d?alert("Can not find uniform"+b+"."):a.uniform4f(d,f,c,g,m)}function loadUniformMatrix3fv(a,d,b,f){d=a.getUniformLocation(d,b);-1==d?alert("Can not find uniform"+b+"."):a.uniformMatrix3fv(d,!1,f)}
function loadUniformMatrix4fv(a,d,b,f){d=a.getUniformLocation(d,b);-1==d?alert("Can not find uniform"+b+"."):a.uniformMatrix4fv(d,!1,f)}function countdownLatch(a,d){var b=a;this.countDown=function(){b--;0>=b&&d()}}function getXYRotationMatrix(a,d){Math.cos(a);Math.cos(d);Math.sin(a);Math.sin(d)}
function rotateXY(a,d,b){var f,c,g=Math.cos(d),m=Math.cos(b);d=Math.sin(d);var k=Math.sin(b),h=d*k,n=m*d,e=g*k,l=g*m;b=a[0];f=a[1];c=a[2];a[0]=b*m+c*k;a[1]=b*h+f*g-c*n;a[2]=-b*e+f*d+c*l;b=a[4];f=a[5];c=a[6];a[4]=b*m+c*k;a[5]=b*h+f*g-c*n;a[6]=-b*e+f*d+c*l;b=a[8];f=a[9];c=a[10];a[8]=b*m+c*k;a[9]=b*h+f*g-c*n;a[10]=-b*e+f*d+c*l;b=a[12];f=a[13];c=a[14];a[12]=b*m+c*k;a[13]=b*h+f*g-c*n;a[14]=-b*e+f*d+c*l;return a}
function rotateZ(a,d){var b,f,c,g;c=Math.cos(d);g=Math.sin(d);b=a[0];f=a[1];a[0]=b*c-f*g;a[1]=b*g+f*c;b=a[4];f=a[5];a[4]=b*c-f*g;a[5]=b*g+f*c;b=a[8];f=a[9];a[8]=b*c-f*g;a[9]=b*g+f*c;b=a[12];f=a[13];a[12]=b*c-f*g;a[13]=b*g+f*c;return a}function extractRotationPart(a,d){d.set(a.subarray(0,3));d.set(a.subarray(4,7),3);d.set(a.subarray(8,11),6);return d}
function Color(a,d,b,f){var c,g,m,k;this.setRed=function(a){c=a;return this};this.getRed=function(){return c};this.setGreen=function(a){g=a;return this};this.getGreen=function(){return g};this.setBlue=function(a){m=a;return this};this.getBlue=function(){return m};this.setAlpha=function(a){k=a;return this};this.getAlpha=function(){return k};this.setRed(a).setGreen(d).setBlue(b).setAlpha(f)}
function surfaceGeometry(a,d){var b,f,c,g,m;f=d;g=a;m=new Float32Array(3*a);b=new Uint16Array(d);c=new Float32Array(3*a);this.setNindices=function(a){f=a};this.getNindices=function(){return f};this.setNvertices=function(a){g=a};this.getNvertices=function(){return g};this.setVerticies=function(a){m=a};this.getVertices=function(){return m};this.setIndices=function(a){};this.getIndices=function(){return b};this.setNormals=function(a){};this.getNormals=function(){return c}}
function GeometryEngine(){}GeometryEngine.Shapes={SPHERE:{value:"sphere"},SQUARE:{value:"square"},CYLINDER:{value:"cylinder"}};GeometryEngine.VertexRegistry=function(){var a;a={};this.registerVertices=function(d,b){if(a.hasOwnProperty(d))throw"Vertex buffers already registered for "+d+".";a[d]=b};this.hasVertices=function(d){return a.hasOwnProperty(d)};this.retrieveVertices=function(d){return a[d]}};
GeometryEngine.square=function(){var a,d,b;b=GeometryEngine.Shapes.SQUARE;a=[-0.5,0.5,0,0.5,0.5,0,0.5,-0.5,0,-0.5,-0.5,0];d=[0,0,1];this.getNindices=function(){return 6};this.computeGeometry=function(a,c){var g,b,k;k=a.getVertices();b=a.getNormals();g=a.getIndices();for(var h=0;12>h;h++)k[h]=c[h],b[h]=d[h%3];g[0]=0;g[1]=3;g[2]=1;g[3]=3;g[4]=2;g[5]=1;a.setNvertices(12);a.setNindices(6)};this.getVertexBuffers=function(f,c){var g,m;c.hasVertices(b.value)?m=c.retrieveVertices(b.value):(g=new surfaceGeometry(4,
6),m={},this.computeGeometry(g,a),m.vertices=createBuffer(f,g.getVertices()),m.normals=createBuffer(f,g.getNormals()),m.indices=createIndexBuffer(f,g.getIndices()),c.registerVertices(b.value,m));return m}};
GeometryEngine.cylinder=function(){var a;a=GeometryEngine.Shapes.CYLINDER;this.getBaseRadius=function(){return 1};this.getShape=function(){return a};this.getNindices=function(){return 126};this.computeGeometry=function(a){var b,f,c,g,m,k,h;h=a.getVertices();g=a.getNormals();c=a.getIndices();h[0]=0;g[0]=0;h[1]=0;g[1]=0;h[2]=0.5;g[2]=1;c[0]=0;b=94;c[b]=b;b*=3;h[b]=0;g[b++]=0;h[b]=0;g[b++]=0;h[b]=-0.5;g[b]=-1;for(f=1;31>=f;f++)b=2*(f-1)*Math.PI/30,c[f]=f,k=3*f,h[k]=1*Math.cos(b),g[k++]=0,h[k]=1*Math.sin(b),
g[k++]=0,h[k]=0.5,g[k]=1;for(f=1;31>=f;f++)k=3*f,b=f+90+4,c[b]=b,b*=3,h[b]=h[k++],g[b++]=0,h[b]=h[k],g[b++]=0,h[b]=-0.5,g[b]=-1;k=3;b=285;m=96;for(f=0;30>=f;f++)c[m/3]=m/3,h[m]=h[k],g[m++]=h[k++]/1,h[m]=h[k],g[m++]=h[k++]/1,h[m]=h[k],g[m++]=h[k++]/1,c[m/3]=m/3,h[m]=h[b],g[m++]=h[b++]/1,h[m]=h[b],g[m++]=h[b++]/1,h[m]=h[b],g[m++]=h[b++]/1;a.setNvertices(378);a.setNindices(126)};this.getVertexBuffers=function(d,b){var f,c;b.hasVertices(a.value)?c=b.retrieveVertices(a.value):(f=new surfaceGeometry(126,
126),c={},this.computeGeometry(f),c.vertices=createBuffer(d,f.getVertices()),c.normals=createBuffer(d,f.getNormals()),c.indices=createIndexBuffer(d,f.getIndices()),b.registerVertices(a.value,c));return c}};
GeometryEngine.sphere=function(){var a;a=GeometryEngine.Shapes.SPHERE;this.getIntrinsicRadius=function(){return 30};this.getShape=function(){return a};this.getNindices=function(){return 5400};this.computeGeometry=function(a,b,f,c){var g,m,k,h,n,e,l,p,z,q,t;q=a.getVertices();l=e=0;k=a.getNormals();for(h=0;h<=f;h++)for(n=h*Math.PI/f,z=Math.sin(n),m=Math.cos(n),n=0;n<=c;n++)g=2*n*Math.PI/c,p=Math.sin(g),g=Math.cos(g),p*=z,t=m,g*=z,k[l]=p,q[l++]=b*p,k[l]=t,q[l++]=b*t,k[l]=g,q[l++]=b*g;a.setNvertices(--l);
k=a.getIndices();for(h=0;h<f;h++)for(n=0;n<c;n++)b=h*(c+1)+n,l=b+c+1,k[e++]=b,k[e++]=l,k[e++]=b+1,k[e++]=l,k[e++]=l+1,k[e++]=b+1;a.setNindices(--e)};this.getVertexBuffers=function(d,b){var f,c;b.hasVertices(a.value)?c=b.retrieveVertices(a.value):(f=new surfaceGeometry(961,5400),c={},this.computeGeometry(f,30,30,30),c.vertices=createBuffer(d,f.getVertices()),c.normals=createBuffer(d,f.getNormals()),c.indices=createIndexBuffer(d,f.getIndices()),b.registerVertices(a.value,c));return c}};
function Charge(a,d,b,f){var c=[d,b,f];this.getCharge=function(){return a};this.setPosition=function(a){this.position=a};this.getPosition=function(){return c};this.getField=function(g,b,f){var h,d=[0,0,0],e;g-=c[0];b-=c[1];f-=c[2];h=g*g+b*b+f*f;if(0>=h)return d;e=Math.sqrt(h);h=a/h;d[0]=h*g/e;d[1]=h*b/e;d[2]=h*f/e;return d};this.getFieldSeedPointsI=function(g){var b,f,h,d,e,l;d=[];e=0<a?1:0>a?-1:0;g=Math.round(g*a*e);b=2/g;for(var p=0;p<g;p++)l=p*b-1+b/2,h=Math.sqrt(1-l*l),f=2.39996323*p,d.push([Math.cos(f)*
h+c[0],l+c[1],Math.sin(f)*h+c[2],e]);return d};this.getStartPoints=function(g){var b,f,h,d,e,l;e=0<a?1:0>a?-1:0;g=Math.round(g*a*e);h=3.6/Math.sqrt(g);b=Math.random()*Math.PI/2;d=[];d.push([0,-1,0,e]);for(var p=1;p<g;p++)l=-1+2*p/(g-1),f=Math.sqrt(1-l*l),b+=h/f,d.push([Math.cos(b)*f+c[0],l+c[1],Math.sin(b)*f+c[2],e]);d.push([0,1,0,e]);return d}}
function Charges(){var a=[],d=[];this.addCharge=function(b){a.push(b);return this};this.getCharges=function(){return a};this.getNCharges=function(){return a.length};this.addDistribution=function(a){d.push(a);return this};this.getDistributions=function(){return d};this.getNDistributions=function(){return d.length};this.getField=function(b,f,c){var g=[0,0,0],g=this.getFieldFromCharges(a,b,f,c);b=this.getFieldFromCharges(d,b,f,c);g[0]+=b[0];g[1]+=b[1];g[2]+=b[2];return g};this.getFieldFromCharges=function(a,
f,c,g){for(var d,k=[0,0,0],h=0,n=a.length;h<n;h++)d=a[h],d=d.getField(f,c,g),k[0]+=d[0],k[1]+=d[1],k[2]+=d[2];return k}}
function fluxLine(a){var d,b,f,c,g=0,m,k,h,n,e,l,p;this.getArrows=function(){return f};this.setMaxPoints=function(a){a!=g&&(g=a,h=new Float32Array(3*g),f=new Float32Array(g));return this};this.getMaxPoints=function(){return g};this.setArrowSize=function(a){d=a;return this};this.getArrowSize=function(){return d};this.setArrowSpacing=function(a){b=a;return this};this.getArrowSpacing=function(){return b};this.getNarrows=function(){return k};this.getNpoints=function(){return m};this.getPoints=function(){return h};
this.setDs=function(a){c=a;return this};this.getDs=function(){return c};this.setSign=function(a){n=a;return this};this.getSign=function(){return n};this.setStartX=function(a){e=a;return this};this.getStartX=function(){return e};this.setStartY=function(a){l=a;return this};this.getStartY=function(){return l};this.setStartZ=function(a){p=a;return this};this.getStartZ=function(){return p};this.drawArrow=function(a,g,b,e,c,d,h){var k,m,l,n,p;k=e[0]/c;m=e[1]/c;l=e[2]/c;0!=l?(n=c=1,e=-(e[0]+e[1])/e[2]):
(0!=m?(c=1,n=-(e[0]+e[2])/e[1]):(c=-(e[1]+e[2])/e[0],n=1),e=1);p=d/Math.sqrt(c*c+n*n+e*e);c*=p;n*=p;e*=p;k*=d;m*=d;d*=l;h*=12;f[h]=a-k+c;f[h+1]=g-m+n;f[h+2]=b-d+e;f[h+3]=a;f[h+4]=g;f[h+5]=b;f[h+6]=a;f[h+7]=g;f[h+8]=b;f[h+9]=a-k-c;f[h+10]=g-m-n;f[h+11]=b-d-e};this.trace=function(){var f,q,t,s,r,B,x;k=f=0;r=e;B=l;x=p;for(s=0;s<g;s++){q=3*s;h[q]=r;h[q+1]=B;h[q+2]=x;t=a.getField(r,B,x);q=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);if(0==q)break;r+=n*t[0]/q*c;B+=n*t[1]/q*c;x+=n*t[2]/q*c;f+=c;f>b&&(f=0,this.drawArrow(r,
B,x,t,q,d,k),k++)}m=s}}
function motionEventHandler(a){var d,b,f,c;d=[];b=!1;c=f=null;this.findTouchByIdentifier=function(a){var f,b;for(f=0;f<d.length;f++)if(b=d[f].identifier,b==a)return f;return-1};this.handleTouchStart=function(a){var f,b,c;c=a.targetTouches;for(f=0;f<c.length;f++)b=c[f],-1==this.findTouchByIdentifier(b.identifier)&&d.push(b);if(a.preventDefault)a.preventDefault();else return!1};this.handleTouchEnd=function(a){var f,b,c;c=a.changedTouches;for(f=0;f<c.length;f++)b=this.findTouchByIdentifier(c[f].identifier),-1!=
b&&d.splice(b,1);if(a.preventDefault)a.preventDefault();else return!1};this.handleOneActiveMove=function(f){var b,c,h,n;n=f.changedTouches[0];c=d[0];null!=c?(b=n.pageX-c.pageX,c=n.pageY-c.pageY,h=a.getModelViewMatrix(),rotateXY(h,c/150,b/150),a.setModelViewMatrix(h),a.render(),d.splice(0,1,n)):d.push(n);if(f.preventDefault)f.preventDefault();else return!1};this.handleTwoActiveMove=function(f){var c,b,h,n,e,l,p,z;l=d[0];h=d[1];c=h.pageX-l.pageX;b=h.pageY-l.pageY;e=Math.sqrt(c*c+b*b);n=Math.atan2(b,
c);z=f.changedTouches;for(c=0;c<z.length;c++)p=z[c],b=p.identifier,l.identifier==b?(l=p,d.splice(0,1,p)):h.identifier==b&&(h=p,d.splice(1,1,p));c=h.pageX-l.pageX;b=h.pageY-l.pageY;l=Math.sqrt(c*c+b*b);n-=Math.atan2(b,c);h=a.getModelViewMatrix();rotateZ(h,n);a.setModelViewMatrix(h);a.zoomBy(-(l-e)/4);if(f.preventDefault)f.preventDefault();else return!1};this.handleTouchMove=function(a){return 1==d.length?this.handleOneActiveMove(a):2==d.length?this.handleTwoActiveMove(a):!0};this.handleMouseDown=function(a){b=
!0;f=a.clientX;c=a.clientY};this.handleMouseUp=function(a){b=!1};this.handleMouseMove=function(g){if(b){var d=g.clientX,k=g.clientY,h=d-f,n=k-c;g=a.getModelViewMatrix();rotateXY(g,n/30,h/30);a.setModelViewMatrix(g);a.render();f=d;c=k}};this.handleMouseWheel=function(c){c=window.event||c;a.zoomBy(c.wheelDeltaY/8);if(c.preventDefault)c.preventDefault();else return!1}}
function cylinder(){var a,d,b;this.setVertexRegistry=function(a){b=a};this.getVertexRegistry=function(){return b};this.setColor=function(a){d=a};this.getColor=function(){return d};this.getCylinderModelView=function(a,c,b,d,k,h,n){var e,l,p;p=Math.sin(n);n=Math.cos(n);l=Math.sin(h);h=Math.cos(h);e=new Float32Array(16);e[0]=k*h*n;e[1]=k*n*l;e[2]=-k*p;e[3]=0;e[4]=-k*l;e[5]=k*h;e[6]=0;e[7]=0;e[8]=d*h*p;e[9]=d*l*p;e[10]=d*n;e[11]=0;e[12]=a;e[13]=c;e[14]=b;e[15]=1;console.log(e[0],e[4],e[8],e[12]);console.log(e[1],
e[5],e[9],e[13]);console.log(e[2],e[6],e[10],e[14]);console.log(e[3],e[7],e[11],e[15]);return e};this.setupBuffers=function(a,c,b,d,k){bindBuffer(a,b,"position",c,3,a.FLOAT,0,0);bindBuffer(a,d,"normal",c,3,a.FLOAT,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,k)};this.drawCap=function(a,c,b){a.drawElements(a.TRIANGLE_FAN,c,a.UNSIGNED_SHORT,2*b)};this.drawSide=function(a,c,b){a.drawElements(a.TRIANGLE_STRIP,c,a.UNSIGNED_SHORT,2*b)};this.drawCylinder=function(a,b,g,d,k){loadUniformMatrix4fv(a,b,"modelViewMatrix",
g);k&&this.drawCap(a,d+2,0);this.drawSide(a,2*d+2,d+2);k&&this.drawCap(a,d+2,3*d+4)};this.fullRender=function(f,c,g,m,k,h){var n,e,l;e=this.getVertexBuffers(f,b);loadUniform4f(f,c,"surfaceColor",d.getRed(),d.getGreen(),d.getBlue(),d.getAlpha());n=(this.getNindices()-6)/4;this.setupBuffers(f,c,e.vertices,e.normals,e.indices);a[3]=g[3];a[7]=g[7];a[8]=g[8];a[9]=g[9];a[10]=g[10];a[11]=g[11];a[12]=g[12];a[13]=g[13];a[14]=g[14];a[15]=g[15];f.cullFace(f.FRONT);for(e=k;e>=m;e--)l=e/k,a[0]=g[0]*l,a[1]=g[1]*
l,a[2]=g[2]*l,a[4]=g[4]*l,a[5]=g[5]*l,a[6]=g[6]*l,this.drawCylinder(f,c,a,n,h);f.cullFace(f.BACK);for(e=m;e<=k;e++)l=e/k,a[0]=g[0]*l,a[1]=g[1]*l,a[2]=g[2]*l,a[4]=g[4]*l,a[5]=g[5]*l,a[6]=g[6]*l,this.drawCylinder(f,c,a,n,h)};this.translateBounds=function(a,b,g,d,k,h,n){var e,l,p;e=(b+k)/2;l=(g+h)/2;p=(d+n)/2;b-=e;g-=l;d-=p;k-=e;h-=l;n-=p;a.setTx(e).setTy(l).setTz(p).setX0(b).setY0(g).setZ0(d).setX1(k).setY1(h).setZ1(n)};this.sign=function(a){return 0>a?-1:1};this.zAxisRotation=function(a,b,d,m,k){var h;
h=Math.atan2(k-d,m-b);b=-this.sign(m)*Math.sqrt(b*b+d*d);d=0;m=-b;k=0;a.setX0(b).setY0(d).setX1(m).setY1(k).setPhi(h)};this.yAxisRotation=function(a,b,d,m,k,h,n){d=Math.sqrt(b*b+d*d+m*m);h=Math.acos(n/d);m=this.sign(n);n=m*d;k=b=0;a.setZ0(-m*d).setZ1(n).setX0(b).setX1(k).setTheta(h)};this.scale=function(a,b,d){var m;m=this.sign(d);b=d-b;a.setZ0(0.5*-m).setZ1(0.5*m).setHeight(b)};a=new Float32Array(16)}cylinder.prototype=new GeometryEngine.cylinder;
function chargedCylinder(a,d,b,f,c,g,m,k,h,n){var e,l,p,z,q,t,s,r,B,x,w,u,y,A,v,C,D,F,E,G,H;this.setHeight=function(a){e=a};this.getHeight=function(){return e};this.setTx=function(a){B=a;return this};this.getTx=function(){return B};this.setTy=function(a){x=a;return this};this.getTy=function(){return x};this.setTz=function(a){w=a;return this};this.getTz=function(){return w};this.setX0=function(a){u=a;return this};this.getX0=function(){return u};this.setY0=function(a){y=a;return this};this.getY0=function(){return y};
this.setZ0=function(a){A=a;return this};this.getZ0=function(){return A};this.setX1=function(a){v=a;return this};this.getX1=function(){return v};this.setY1=function(a){C=a;return this};this.getY1=function(){return C};this.setZ1=function(a){D=a;return this};this.getZ1=function(){return D};this.setR0=function(a){s=a;return this};this.getR0=function(){return s};this.setR1=function(a){r=a;return this};this.getR1=function(){return r};this.setPhi=function(a){p=a;return this};this.getPhi=function(){return p};
this.setTheta=function(a){z=a;return this};this.adjustStartPoints=function(a){var b,c,e,d,f;b=a.length;for(var g=0;g<b;g++)c=a[g],e=c[0],d=c[1],f=c[2],c[0]=l[0]*e+l[4]*d+l[8]*f+l[12],c[1]=l[1]*e+l[5]*d+l[9]*f+l[13],c[2]=l[2]*e+l[6]*d+l[10]*f+l[14];return a};this.getStartPoints=function(){var a,b,c,d,f,g,h;h=[];if(0!=t){g=this.sign(q);b=Math.max(2,Math.round(Math.abs(q*Math.PI*(r*r-s*s)*t*e)));c=(s+1)/r;d=0.707106781*(s+1)/r;f=-0.5;a=1/(b-1);for(var k=0;k<b;k++)h.push([c,0,f,g]),h.push([-c,0,f,g]),
h.push([0,c,f,g]),h.push([0,-c,f,g]),h.push([d,d,f,g]),h.push([d,-d,f,g]),h.push([-d,-d,f,g]),h.push([-d,d,f,g]),f+=a}return this.adjustStartPoints(h)};this.getNormal=function(a,b,c){var e,d,f,g;e={};d=-((u-a)*F+(y-b)*E+(A-c)*G)/(H*H);f=u+d*F;g=y+d*E;d=A+d*G;e.x=a-f;e.y=b-g;e.z=c-d;return e};this.getField=function(a,b,c){var e;e=Array(3);b=this.getNormal(a,b,c);c=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);a=2*(c<s?0:c<r?Math.PI*(c*c-s*s)*q:Math.PI*(r*r-s*s)*q)/c;e[0]=a*b.x/c;e[1]=a*b.y/c;e[2]=a*b.z/c;return e};
this.render=function(a,b){this.fullRender(a,b,l,s,r,!1)};s=m;r=k;q=h;t=n;u=a;y=d;A=b;v=f;C=c;D=g;m=0<q?new Color(0.05,0.05,0.8,0.3):0>q?new Color(0.8,0.05,0.05,0.3):new Color(0.5,0.5,0.5,0.2);this.setColor(m);this.translateBounds(this,u,y,A,v,C,D);this.zAxisRotation(this,u,y,v,C);this.yAxisRotation(this,u,y,A,v,C,D);this.scale(this,A,D);u=a;y=d;A=b;v=f;C=c;D=g;l=this.getCylinderModelView(B,x,w,e,r,p,z);F=v-u;E=C-y;G=D-A;H=Math.sqrt(F*F+E*E+G*G)}chargedCylinder.prototype=new cylinder;
function chargedLine(a,d,b,f,c,g,m,k){var h,n,e,l,p,z,q,t,s,r,B,x,w,u,y,A,v,C,D,F,E;this.setHeight=function(a){h=a};this.getHeight=function(){return h};this.setTx=function(a){s=a;return this};this.getTx=function(){return s};this.setTy=function(a){r=a;return this};this.getTy=function(){return r};this.setTz=function(a){B=a;return this};this.getTz=function(){return B};this.setX0=function(a){x=a;return this};this.getX0=function(){return x};this.setY0=function(a){w=a;return this};this.getY0=function(){return w};
this.setZ0=function(a){u=a;return this};this.getZ0=function(){return u};this.setX1=function(a){y=a;return this};this.getX1=function(){return y};this.setY1=function(a){A=a;return this};this.getY1=function(){return A};this.setZ1=function(a){v=a;return this};this.getZ1=function(){return v};this.setR0=function(a){q=a;return this};this.getR0=function(){return q};this.setR1=function(a){t=a;return this};this.getR1=function(){return t};this.setPhi=function(a){l=a;return this};this.getPhi=function(){return l};
this.setTheta=function(a){p=a;return this};this.adjustStartPoints=function(a){var b,c,d,f,g;b=a.length;for(var h=0;h<b;h++)c=a[h],d=c[0],f=c[1],g=c[2],c[0]=e[0]*d+e[4]*f+e[8]*g+e[12],c[1]=e[1]*d+e[5]*f+e[9]*g+e[13],c[2]=e[2]*d+e[6]*f+e[10]*g+e[14];return a};this.getStartPoints=function(){var a,b,c,e,d;d=[];if(0!=z){e=this.sign(n);b=Math.max(2,Math.round(Math.abs(n*z*h)));c=-0.5;a=1/(b-1);for(var f=0;f<b;f++)d.push([1,0,c,e]),d.push([-1,0,c,e]),d.push([0,1,c,e]),d.push([0,-1,c,e]),d.push([0.707106781,
0.707106781,c,e]),d.push([0.707106781,-0.707106781,c,e]),d.push([-0.707106781,-0.707106781,c,e]),d.push([-0.707106781,0.707106781,c,e]),c+=a}return this.adjustStartPoints(d)};this.getNormal=function(a,b,c){var e,d,f,g;e={};d=-((x-a)*C+(w-b)*D+(u-c)*F)/(E*E);f=x+d*C;g=w+d*D;d=u+d*F;e.x=a-f;e.y=b-g;e.z=c-d;return e};this.getField=function(a,b,c){var e;c=this.getNormal(a,b,c);e=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);a=Array(3);b=2*n/e;a[0]=b*c.x/e;a[1]=b*c.y/e;a[2]=b*c.z/e;return a};this.render=function(a,
b){this.fullRender(a,b,e,q,t,!1)};n=m;m=0<n?new Color(0.05,0.05,0.8,0.8):0>n?new Color(0.8,0.05,0.05,0.8):new Color(0.5,0.5,0.5,0.8);this.setColor(m);q=0;t=3;z=k;x=a;w=d;u=b;y=f;A=c;v=g;this.translateBounds(this,x,w,u,y,A,v);this.zAxisRotation(this,x,w,y,A);this.yAxisRotation(this,x,w,u,y,A,v);this.scale(this,u,v);x=a;w=d;u=b;y=f;A=c;v=g;e=this.getCylinderModelView(s,r,B,h,t,l,p);C=y-x;D=A-w;F=v-u;E=Math.sqrt(C*C+D*D+F*F)}chargedLine.prototype=new cylinder;
function chargedPlane(a,d,b,f,c,g,m,k,h,n,e,l,p,z){var q,t,s,r,B,x,w,u,y,A,v,C,D,F,E,G,H,I,J,M,L,K;this.setVertexRegistry=function(a){L=a};this.getVertexRegistry=function(){return L};this.calculateNormal=function(a){var b;b=Array(3);b[0]=(a[4]-a[1])*(a[11]-a[2])-(a[5]-a[2])*(a[10]-a[1]);b[1]=(a[5]-a[2])*(a[9]-a[0])-(a[3]-a[0])*(a[11]-a[2]);b[2]=(a[3]-a[0])*(a[10]-a[1])-(a[4]-a[1])*(a[9]-a[0]);a=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);b[0]/=a;b[1]/=a;b[2]/=a;return b};this.adjustStartPoints=function(a){var b,
c,e,d,f;b=a.length;for(var g=0;g<b;g++)c=a[g],e=c[0],d=c[1],f=c[2],c[0]=H+w*(E*e*B+f*v)+D*(-G*d*x+C*(-E*e*v+f*B)),c[1]=I+w*(G*d*x+C*(E*e*v-f*B))+D*(E*e*B+f*v),c[2]=J+G*d*C+x*(-E*e*v+f*B);return a};this.getStartPoints=function(){var a,b,c,e,d,f,g;b=Math.abs(F*A);d=[];if(0<b)for(a=Math.sqrt(1/b),b=a/Math.abs(E),a/=Math.abs(G),c=!1,e=0<F?1:-1,f=Math.min(-0.5+b/2,0.5),g=Math.min(-0.5+a/2,0.5);!c;)d.push([f,g,0.4,e]),d.push([f,g,-0.4,e]),g+=a,0.5<g?(g=0.5-(g-0.5),f+=b,a=-a):-0.5>g&&(g=-0.5-(g- -0.5),f+=
b,a=-a),c=0.5<f;return this.adjustStartPoints(d)};this.getField=function(a,b,c){var e;e=Array(3);a=(a-r[0])*y[0]+(b-r[1])*y[1]+(c-r[2])*y[2];b=M*F;0==a&&(e[0]=0,e[1]=0,e[2]=0);0<a?(e[0]=b*y[0],e[1]=b*y[1],e[2]=b*y[2]):(e[0]=-b*y[0],e[1]=-b*y[1],e[2]=-b*y[2]);return e};this.translateBoundingBox=function(a){H=(b+h)/2;I=(f+n)/2;J=(c+e)/2;a[0]-=H;a[1]-=I;a[2]-=J;a[3]-=H;a[4]-=I;a[5]-=J;a[6]-=H;a[7]-=I;a[8]-=J;a[9]-=H;a[10]-=I;a[11]-=J;return a};this.zAxisRotation=function(a){var b,c;b=a[3]-a[0];c=a[0]-
a[9];0==b||0==c?(s=0,K=0==b&&0==c?0==a[4]-a[1]?1:2:0==b?1:2):(b=(m-f)/b,c=(n-m)/c,Math.abs(b)<Math.abs(c)?(s=Math.atan(b),K=1):(s=Math.atan(c),K=2));w=Math.cos(s);D=Math.sin(s);for(var e=0;4>e;e++)c=w*a[3*e]-D*a[3*e+1],b=D*a[3*e]+w*a[3*e+1],a[3*e]=c,a[3*e+1]=b;return a};this.xAxisRotation=function(a,b){var c,e;1==b?(c=a[1]-a[10],e=a[2]-a[11]):(c=a[4]-a[1],e=a[5]-a[2]);C=t=0;x=1;if(0!=e&&0!=c){t=Math.atan(e/c);C=Math.sin(t);x=Math.cos(t);for(var d=0;4>d;d++)c=x*a[3*d+1]-C*a[3*d+2],e=C*a[3*d+1]+x*a[3*
d+2],a[3*d+1]=c,a[3*d+2]=e}return a};this.yAxisRotation=function(a,b){var c,e;1==b?(c=a[0]-a[9],e=a[2]-a[11]):(c=a[3]-a[0],e=a[5]-a[2]);v=q=0;B=1;if(0!=e){0!=c?(q=Math.atan(e/c),v=Math.sin(q),B=Math.cos(q)):(q=1.5707963267948966,v=1,B=0);for(var d=0;4>d;d++)c=B*a[3*d]+v*a[3*d+2],e=-v*a[3*d]+B*a[3*d+2],a[3*d]=c,a[3*d+2]=e}return a};this.scaleBoundingbox=function(a,b){1==b?(E=a[0]-a[9],G=a[4]-a[1]):(E=a[3]-a[0],G=a[1]-a[10]);for(;;)return 0!=E&&(a[0]/=E),0!=G&&(a[1]/=G),a};this.getModelView=function(){return u};
this.drawFullSurface=function(a,b,c,e,d,f){bindBuffer(a,c,"position",b,3,a.FLOAT,0,0);bindBuffer(a,e,"normal",b,3,a.FLOAT,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d);a.drawElements(a.TRIANGLES,f,a.UNSIGNED_SHORT,0)};this.render=function(a,b){var c,e;c=this.getVertexBuffers(a,L);0<F?loadUniform4f(a,b,"surfaceColor",0.05,0.05,0.8,0.4):0>F?loadUniform4f(a,b,"surfaceColor",0.8,0.05,0.05,0.4):loadUniform4f(a,b,"surfaceColor",0.5,0.5,0.5,0.2);e=this.getNindices();loadUniformMatrix4fv(a,b,"modelViewMatrix",
this.getModelView());a.disable(a.CULL_FACE);this.drawFullSurface(a,b,c.vertices,c.normals,c.indices,e);a.enable(a.CULL_FACE)};M=6.283185307179586;F=a;A=d;r=[b,f,c,g,m,k,h,n,e,l,p,z];a=r.slice(0);y=this.calculateNormal(r);a=this.translateBoundingBox(a);a=this.zAxisRotation(a);a=this.xAxisRotation(a,K);a=this.yAxisRotation(a,K);a=this.scaleBoundingbox(a,K);u=new Float32Array(16);B=Math.cos(-q);x=Math.cos(-t);w=Math.cos(-s);v=Math.sin(-q);C=Math.sin(-t);D=Math.sin(-s);u[0]=E*(B*w-v*C*D);u[1]=E*(B*D+
w*v*C);u[2]=-E*x*v;u[3]=0;u[4]=-G*x*D;u[5]=G*x*w;u[6]=G*C;u[7]=0;u[8]=C*D*B+v*w;u[9]=-(C*B*w-v*D);u[10]=B*x;u[11]=0;u[12]=H;u[13]=I;u[14]=J;u[15]=1}chargedPlane.prototype=new GeometryEngine.square;
function chargedSphere(a,d,b,f,c,g,m){var k,h,n,e,l,p,z,q;z=0;k=g;h=k*k;n=h*k;e=m;l=e*e*e;this.setA=function(a){k=a;h=k*k;n=h*k};this.getA=function(){return k};this.setB=function(a){e=a;l=e*e*e};this.getB=function(){return e};this.setNindices=function(a){z=a};this.setVertexRegistry=function(a){q=a};this.getVertexRegistry=function(){return q};this.getStartPoints=function(){var g,h,l,m,n,p,q;p=0<a?1:0>a?-1:0;g=Math.round(d*a*p);m=4*k/Math.sqrt(g);h=0;n=[];for(var z=0;z<g;z++)q=(-1+2*z/(g-1))*k,l=Math.sqrt(k*
k-q*q)+0.2*(e-k),h+=m/l,n.push([Math.cos(h)*l+b,q+f,Math.sin(h)*l+c,p]);return n};this.getField=function(d,g,m){var p,q=[0,0,0],w;d-=b;g-=f;m-=c;p=d*d+g*g+m*m;if(p<=h)return q;w=Math.sqrt(p);p=w>=k&&w<e?a*(w-n/p)/(l-n):a/p;q[0]=p*d/w;q[1]=p*g/w;q[2]=p*m/w;return q};this.getModelView=function(a){"undefined"===typeof a&&(a=1);null==p?(p=new Float32Array(16),p[0]=a,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=a,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=a,p[11]=0,p[12]=b,p[13]=f,p[14]=c,p[15]=1):(p[0]=a,p[5]=a,p[10]=a);
return p};this.drawFullSurface=function(a,b,c,e,d,f){bindBuffer(a,c,"position",b,3,a.FLOAT,0,0);bindBuffer(a,e,"normal",b,3,a.FLOAT,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d);a.drawElements(a.TRIANGLES,f,a.UNSIGNED_SHORT,0)};this.render=function(b,c){var d,f,g,h;d=this.getIntrinsicRadius();h=this.getVertexBuffers(b,q);0<a?loadUniform4f(b,c,"surfaceColor",0.05,0.05,0.8,0.2):0>a?loadUniform4f(b,c,"surfaceColor",0.8,0.05,0.05,0.2):loadUniform4f(b,c,"surfaceColor",0.5,0.5,0.5,0.2);z=this.getNindices();
b.cullFace(b.FRONT);for(f=e;f>=k;f--)g=f/d,loadUniformMatrix4fv(b,c,"modelViewMatrix",this.getModelView(g)),this.drawFullSurface(b,c,h.vertices,h.normals,h.indices,z);b.cullFace(b.BACK);for(f=k;f<=e;f++)g=f/d,this.drawFullSurface(b,c,h.vertices,h.normals,h.indices,z),loadUniformMatrix4fv(b,c,"modelViewMatrix",this.getModelView(g))}}chargedSphere.prototype=new GeometryEngine.sphere;
function fieldRenderer(a,d){var b,f,c,g,m,k,h,n,e,l,p,z,q,t,s,r,B,x,w,u,y,A,v,C,D;c=new Charges;m=[];l=[];r="undefined"==typeof d?"./":d;p=!1;v=m;D=new GeometryEngine.VertexRegistry;this.addGaussianSurface=function(a){a.setVertexRegistry(D);l.push(a);return this};this.addChargeDistribution=function(a){a.setVertexRegistry(D);c.addDistribution(a);return this};this.addStartPoint=function(a,b,c,e){m.push([a,b,c,e]);return this};this.addCharge=function(a){c.addCharge(a);return this};this.getContext=function(){return e};
this.getCharges=function(){return c};this.createSurfaceProgram=function(a){var b,c;c=compileShader(a,"attribute vec3 normal;attribute vec3 position;uniform   vec3 ambientLighting;uniform   vec3 directionalLighting;uniform   vec3 directionalColor;uniform   mat4 modelViewMatrix;uniform   mat4 globalModelViewMatrix;uniform   mat3 normalMatrix;uniform   mat4 projectionMatrix;varying   vec3 lighting;void main(void){  gl_Position = projectionMatrix * globalModelViewMatrix * modelViewMatrix * vec4(position, 1.0);  vec3  transformedNormal         = normalMatrix * normal;  float directionalLightWeighting = max(dot(transformedNormal, directionalLighting), 0.0);  lighting                        = ambientLighting + directionalColor * directionalLightWeighting;}",
a.VERTEX_SHADER);b=compileShader(a,"precision mediump float;uniform vec4 surfaceColor;varying vec3 lighting;void main(void){  gl_FragColor = vec4(surfaceColor.rgb * lighting, surfaceColor.a);}",a.FRAGMENT_SHADER);return createProgram(a,c,b)};this.createFluxLineProgram=function(a){var b=compileShader(a,"attribute vec3 position;uniform   mat4 modelViewMatrix;uniform   mat4 projectionMatrix;void main(){    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);}",a.VERTEX_SHADER),c=compileShader(a,
"precision mediump float;void main(){    gl_FragColor = vec4(0.8,0.3,0.3,1);}",a.FRAGMENT_SHADER);return createProgram(a,b,c)};this.createChargeProgram=function(a){var b=compileShader(a,"precision highp float;attribute vec3  position;attribute float charge;varying   float vCharge;uniform   mat4  modelViewMatrix;uniform   mat4  projectionMatrix;void main(){    gl_Position  = projectionMatrix * modelViewMatrix * vec4(position, 1);    gl_PointSize = 16.0;    vCharge      = charge;}",a.VERTEX_SHADER),
c=compileShader(a,"precision lowp float;varying float     vCharge;uniform sampler2D positiveChargeSampler;uniform sampler2D negativeChargeSampler;vec4   textureColor; void main() {   if (vCharge > 0.0)   {       textureColor = texture2D(positiveChargeSampler, gl_PointCoord);   }   else   {       textureColor = texture2D(negativeChargeSampler, gl_PointCoord);   }   if (textureColor.a > 0.5)   {       gl_FragColor = textureColor;   }   else   {       discard;   } }",a.FRAGMENT_SHADER);return createProgram(a,
b,c)};this.makeChargesArray=function(a){var b,c,e,d,f;f=a.getCharges();c=f.length;b=new Float32Array(4*c);for(var g=0;g<c;g++)a=f[g],d=a.getPosition(),e=4*g,b[e]=d[0],b[e+1]=d[1],b[e+2]=d[2],b[e+3]=a.getCharge();return b};this.drawCharges=function(a,b,c,e,d,f,g,h,k,l){a.useProgram(b);loadUniformMatrix4fv(a,b,"modelViewMatrix",c);loadUniformMatrix4fv(a,b,"projectionMatrix",e);bindBuffer(a,d,"position",b,3,a.FLOAT,16,0);bindBuffer(a,d,"charge",b,1,a.FLOAT,16,12);bindTexture(a,b,g,h,"positiveChargeSampler");
bindTexture(a,b,k,l,"negativeChargeSampler");a.drawArrays(a.POINTS,0,f)};this.drawFluxlines=function(a,b,c,e,d,f,g,h){a.useProgram(b);a.lineWidth(1);loadUniformMatrix4fv(a,b,"modelViewMatrix",e);loadUniformMatrix4fv(a,b,"projectionMatrix",c);c=g.length;for(d=0;d<c;d++)e=f[d],bindBuffer(a,g[d],"position",b,3,a.FLOAT,12,0),a.drawArrays(a.LINE_STRIP,0,e[4]),bindBuffer(a,h[d],"position",b,3,a.FLOAT,12,0),a.drawArrays(a.LINES,0,e[5])};this.drawChargeDistributions=function(a,b,c,e,d,f){console.assert(null!=
b);a.useProgram(b);loadUniformMatrix4fv(a,b,"globalModelViewMatrix",e);loadUniformMatrix3fv(a,b,"normalMatrix",d);loadUniformMatrix4fv(a,b,"projectionMatrix",c);loadUniform3f(a,b,"ambientLighting",0.3,0.3,0.3);loadUniform3f(a,b,"directionalLighting",1,1,1);loadUniform3f(a,b,"directionalColor",0.4,0.4,0.4);c=f.length;for(e=0;e<c;e++)f[e].render(a,b)};this.drawGaussianSurfaces=function(a,b,c,e,d,f){console.assert(null!=b);a.useProgram(b);loadUniformMatrix4fv(a,b,"globalModelViewMatrix",e);loadUniformMatrix3fv(a,
b,"normalMatrix",d);loadUniformMatrix4fv(a,b,"projectionMatrix",c);loadUniform4f(a,b,"surfaceColor",0.5,0.5,0.5,0.5);loadUniform3f(a,b,"ambientLighting",0.3,0.3,0.3);loadUniform3f(a,b,"directionalLighting",1,1,1);loadUniform3f(a,b,"directionalColor",0.4,0.4,0.4);c=f.length;for(e=0;e<c;e++)f[e].render(a,b)};this.setModelViewMatrix=function(a){t=a;s=extractRotationPart(t,s)};this.getModelViewMatrix=function(){return t};this.render=function(){p&&(e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawCharges(e,
f,t,y,b,c.getNCharges(),u,w,x,B),this.drawFluxlines(e,n,y,t,c,v,h,k),0<l.length||0<c.getNDistributions())&&(e.enable(e.BLEND),e.enable(e.CULL_FACE),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),0<c.getNDistributions()&&this.drawChargeDistributions(e,C,y,t,s,c.getDistributions()),e.disable(e.DEPTH_TEST),0<l.length&&this.drawGaussianSurfaces(e,C,y,t,s,l),e.enable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.CULL_FACE))};this.zoomBy=function(a){A+=a;15>A&&(A=15);y=generateOrthographicMatrix(A,A,-A,
A);this.render()};this.allocateStorage=function(){window.webkitStorageInfo.requestQuota(PERSISTENT,2147483648,function(a){console.log("Got storage",a);window.webkitRequestFileSystem(PERSISTENT,a,function(a){window.fs=a;console.log("Got filesystem")})},function(a){console.log("Storage error",a)})};this.capture=function(a){var b=Math.random(),c=a.toDataURL("image/png").slice(22);window.fs.root.getFile(b,{create:!0},function(a){a.createWriter(function(a){for(var b=atob(c),e=new Uint8Array(b.length),
d=0;d<b.length;++d)e[d]=b.charCodeAt(d);b=new Blob([e],{});a.seek(0);a.write(b);console.log("Writing file",frames,b.size)})},function(){console.log("File error",arguments)})};this.initialRender=function(){var a,d,s;y=generateOrthographicMatrix(A,A,-A,A);f=this.createChargeProgram(e);g=this.makeChargesArray(c);b=createBuffer(e,g);n=this.createFluxLineProgram(e);h=[];k=[];v=m;a=c.getDistributions();s=a.length;for(var r=0;r<s;r++)d=a[r].getStartPoints(),v=v.concat(d);new Float32Array(3*q);d=v.length;
a=new fluxLine(c);a.setMaxPoints(5E3);a.setDs(0.3);a.setArrowSpacing(50);a.setArrowSize(3);for(r=0;r<d;r++)s=v[r],a.setStartX(s[0]),a.setStartY(s[1]),a.setStartZ(s[2]),a.setSign(s[3]),a.trace(),h[r]=createBuffer(e,a.getPoints()),s[4]=a.getNpoints(),k[r]=createBuffer(e,a.getArrows()),s[5]=a.getNarrows();if(0<l.length||0<c.getNDistributions())C=this.createSurfaceProgram(e);p=!0;this.render()};this.start=function(){z.countDown()};z=new countdownLatch(3,this.initialRender.bind(this));if(e=getGLContext(a))B=
0,x=loadTexture(e,r+"images/negativeCharge.png",B,z.countDown),w=1,u=loadTexture(e,r+"images/positiveCharge.png",w,z.countDown),t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),s=new Float32Array([1,0,0,0,1,0,0,0,1]),q=5E3,A=150,r=new motionEventHandler(this),a.addEventListener("mousewheel",r.handleMouseWheel.bind(r),!1),a.addEventListener("mousedown",r.handleMouseDown.bind(r),!1),document.addEventListener("mouseup",r.handleMouseUp.bind(r),!1),document.addEventListener("mousemove",r.handleMouseMove.bind(r),
!1),a.addEventListener("touchstart",r.handleTouchStart.bind(r),!1),a.addEventListener("touchmove",r.handleTouchMove.bind(r),!1),a.addEventListener("touchend",r.handleTouchEnd.bind(r),!1)}
function gaussianCylinder(a,d,b,f,c,g,m){var k,h,n,e,l,p,z,q,t;this.setX=function(a){z=a;return this};this.getX=function(){return z};this.setY=function(a){q=a;return this};this.getY=function(){return q};this.setZ=function(a){t=a;return this};this.getZ=function(){return t};this.setRadius=function(a){l=a;return this};this.getRadius=function(){return l};this.setHeight=function(a){h=a;return this};this.getHeight=function(){return h};this.setTheta=function(a){p=a;return this};this.getheta=function(){return p};
this.setPhi=function(a){e=a;return this};this.getPhi=function(){return e};this.render=function(a,b){this.fullRender(a,b,n,l,l,!0)};k=new Color(0.5,0.5,0.5,0.5);h=f;e=g;l=c;p=m;z=a;q=d;t=b;this.setColor(k);n=this.getCylinderModelView(z,q,t,h,l,e,p)}gaussianCylinder.prototype=new cylinder;
function gaussianSphere(a,d,b,f){var c,g,m,k,h,n;g=f;k=a;h=d;n=b;this.setVertexRegistry=function(a){m=a};this.getVertexRegistry=function(){return m};this.setX=function(a){k=a;return this};this.getX=function(){return k};this.setY=function(a){h=a;return this};this.getY=function(){return h};this.setZ=function(a){n=a;return this};this.getZ=function(){return n};this.setRadius=function(a){g=a;return this};this.getRadius=function(){return g};this.getModelView=function(a){"undefined"===typeof a&&(a=1);null==
c?(c=new Float32Array(16),c[0]=a,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a,c[11]=0,c[12]=k,c[13]=h,c[14]=n,c[15]=1):(c[0]=a,c[5]=a,c[10]=a);return c};this.drawFullSurface=function(a,b,c,d,f,g){bindBuffer(a,c,"position",b,3,a.FLOAT,0,0);bindBuffer(a,d,"normal",b,3,a.FLOAT,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f);a.drawElements(a.TRIANGLES,g,a.UNSIGNED_SHORT,0)};this.render=function(a,b){var c,d;c=this.getIntrinsicRadius();d=this.getVertexBuffers(a,m);loadUniformMatrix4fv(a,
b,"modelViewMatrix",this.getModelView(g/c));a.cullFace(a.FRONT);this.drawFullSurface(a,b,d.vertices,d.normals,d.indices,this.getNindices());a.cullFace(a.BACK);this.drawFullSurface(a,b,d.vertices,d.normals,d.indices,this.getNindices())}}gaussianSphere.prototype=new GeometryEngine.sphere;
